{
  final long start=System.currentTimeMillis();
  final long end=start + 20000;
  USMState currentState=null;
  while (System.currentTimeMillis() < end) {
    ServiceMonitors[] monitors=usm.getServicesMonitors();
    Object state=monitors[0].getMonitors().get("USM_State");
    if (state != null) {
      currentState=USMState.values()[(Integer)state];
      if (currentState.equals(targetState)) {
        break;
      }
    }
    Thread.sleep(2000);
  }
  Assert.assertEquals(targetState,currentState);
}
