{
  try {
    final MachineDetails previousMachineDetails=getPreviousMachineDetailsFromFailedGSA(failedAgent);
    ServiceVolume volume=getAttachedVolumeFromSpace(serviceName,previousMachineDetails);
    previousMachineDetails.setAttachedVolumeId(volume.getId());
    final ProvisioningContextImpl ctx=setUpProvisioningContext(null,null,previousMachineDetails);
    cloudifyProvisioning.onMachineFailure(ctx,duration,timeUnit);
    if (storageProvisioning != null && storageProvisioning instanceof BaseStorageDriver) {
      ((BaseStorageDriver)storageProvisioning).onMachineFailure(ctx,storageTemplateName,duration,timeUnit);
    }
  }
 catch (  final Exception e) {
    throw new ElasticMachineProvisioningException("Failed to manage cloud resources following machine failure",e);
  }
}
