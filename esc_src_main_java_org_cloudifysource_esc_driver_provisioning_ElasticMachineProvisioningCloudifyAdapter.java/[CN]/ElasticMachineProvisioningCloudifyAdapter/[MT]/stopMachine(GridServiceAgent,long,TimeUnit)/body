{
  final String machineIp=agent.getMachine().getHostAddress();
  logger.fine("Shutting down agent: " + agent + " on host: "+ machineIp);
  try {
    agent.shutdown();
    logger.fine("Agent on host: " + machineIp + " successfully shut down");
  }
 catch (  final Exception e) {
    logger.log(Level.WARNING,"Failed to shutdown agent on host: " + machineIp + ". Continuing with shutdown of machine.",e);
  }
  try {
    logger.fine("Cloudify Adapter is shutting down machine with ip: " + machineIp);
    final boolean shutdownResult=this.cloudifyProvisioning.stopMachine(machineIp,duration,unit);
    logger.info("Shutdown result of machine: " + machineIp + " was: "+ shutdownResult);
    return shutdownResult;
  }
 catch (  final CloudProvisioningException e) {
    throw new ElasticMachineProvisioningException("Attempt to shutdown machine with IP: " + machineIp + " for agent with UID: "+ agent.getUid()+ " has failed with error: "+ e.getMessage(),e);
  }
catch (  final AdminException e) {
    throw new ElasticMachineProvisioningException("Failed to shutdown agent " + agent.getMachine().getHostAddress(),e);
  }
}
