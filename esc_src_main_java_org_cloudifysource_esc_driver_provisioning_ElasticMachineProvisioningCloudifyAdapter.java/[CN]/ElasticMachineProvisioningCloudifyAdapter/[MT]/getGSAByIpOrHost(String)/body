{
  GridServiceAgent gsa=null;
  Map<String,GridServiceAgent> gsaByHostAddress=originalESMAdmin.getGridServiceAgents().getHostAddress();
  for (  String hostAddress : gsaByHostAddress.keySet()) {
    if (hostAddress.equals(machineIp) || IPUtils.isSameIpv6Address(hostAddress,machineIp)) {
      gsa=gsaByHostAddress.get(hostAddress);
      break;
    }
  }
  if (gsa == null) {
    gsa=originalESMAdmin.getGridServiceAgents().getHostNames().get(machineIp);
  }
  return gsa;
}
