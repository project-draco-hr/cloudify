{
  if (cloudOverrides != null) {
    if (cloudOverrides.length() >= TEN_K) {
      throw new CLIStatusException(CloudifyErrorMessages.CLOUD_OVERRIDES_TO_LONG.getName());
    }
  }
  RecipePathResolver pathResolver=new RecipePathResolver();
  if (pathResolver.resolveService(recipe)) {
    recipe=pathResolver.getResolved();
  }
 else {
    throw new CLIStatusException("service_file_doesnt_exist",StringUtils.join(pathResolver.getPathsLooked().toArray(),", "));
  }
  File packedFile;
  final File cloudConfigurationZipFile=createCloudConfigurationZipFile();
  Service service=null;
  try {
    if (recipe.getName().endsWith(".jar") || recipe.getName().endsWith(".war")) {
      packedFile=recipe;
    }
 else     if (recipe.isDirectory()) {
      final List<File> additionFiles=new LinkedList<File>();
      if (cloudConfigurationZipFile != null) {
        additionFiles.add(cloudConfigurationZipFile);
      }
      File recipeFile=recipe;
      if (serviceFileName != null) {
        final File fullPathToRecipe=new File(recipe.getAbsolutePath() + "/" + serviceFileName);
        if (!fullPathToRecipe.exists()) {
          throw new CLIStatusException("service_file_doesnt_exist",fullPathToRecipe.getPath());
        }
        recipeFile=fullPathToRecipe.isDirectory() ? DSLReader.findDefaultDSLFile(DSLReader.SERVICE_DSL_FILE_NAME_SUFFIX,fullPathToRecipe) : fullPathToRecipe;
      }
 else {
        recipeFile=DSLReader.findDefaultDSLFile(DSLReader.SERVICE_DSL_FILE_NAME_SUFFIX,recipe);
      }
      final DSLReader dslReader=createDslReader(recipeFile);
      service=dslReader.readDslEntity(Service.class);
      File servicePropertiesFile=DSLReader.findDefaultDSLFileIfExists(DSLUtils.PROPERTIES_FILE_SUFFIX,recipe);
      if (servicePropertiesFile == null) {
        servicePropertiesFile=new File(recipe,serviceName + "-service" + DSLUtils.PROPERTIES_FILE_SUFFIX);
      }
      File finalPropsFile=new File(servicePropertiesFile.getName());
      FileAppender appender=new FileAppender(finalPropsFile);
      if (overrides != null) {
        appender.append("Service Properties File",servicePropertiesFile);
        appender.append("Overrides Properties File",overrides);
        appender.flush();
        additionFiles.add(finalPropsFile);
      }
      packedFile=Packager.pack(recipeFile,false,service,additionFiles);
      packedFile.deleteOnExit();
      finalPropsFile.delete();
    }
 else {
      packedFile=recipe;
      service=ServiceReader.readServiceFromZip(packedFile);
    }
  }
 catch (  final IOException e) {
    throw new CLIException(e);
  }
catch (  final PackagingException e) {
    throw new CLIException(e);
  }
  final String currentApplicationName=getCurrentApplicationName();
  Properties props=null;
  if (service != null) {
    props=createServiceContextProperties(service);
    if (serviceFileName != null) {
      props.setProperty(CloudifyConstants.CONTEXT_PROPERTY_SERVICE_FILE_NAME,serviceFileName);
    }
    if (serviceName == null || serviceName.isEmpty()) {
      serviceName=service.getName();
    }
  }
 else {
    if (serviceName == null || serviceName.isEmpty()) {
      serviceName=recipe.getName();
      final int endIndex=serviceName.lastIndexOf('.');
      if (endIndex > 0) {
        serviceName=serviceName.substring(0,endIndex);
      }
    }
  }
  if (zone == null || zone.isEmpty()) {
    zone=serviceName;
  }
  String templateName;
  if (service == null || service.getCompute() == null) {
    templateName="";
  }
 else {
    templateName=service.getCompute().getTemplate();
    if (templateName == null) {
      templateName="";
    }
  }
  try {
    final String lifecycleEventContainerPollingID=adminFacade.installElastic(packedFile,currentApplicationName,serviceName,zone,props,templateName,authGroups,getTimeoutInMinutes(),!disableSelfHealing,cloudOverrides);
    pollForLifecycleEvents(lifecycleEventContainerPollingID);
  }
  finally {
    if (recipe.isDirectory()) {
      FileUtils.deleteQuietly(packedFile.getParentFile());
    }
  }
  return getFormattedMessage("service_install_ended",Color.GREEN,serviceName);
}
