{
  AzureServiceDefinition[] services=serviceList.toArray(new AzureServiceDefinition[serviceList.size()]);
  File cspkg=new File(azureHostedServiceName + ".cspkg");
  AzureDeploymentConfigurationFile cscfgFile=new AzureDeploymentConfigurationFile(new File(inDirectory,"ServiceConfiguration.Cloud.cscfg"));
  AzureDeploymentDefinitionFile csdefFile=new AzureDeploymentDefinitionFile(new File(inDirectory,"ServiceDefinition.csdef"));
  String cscfgFileName="ServiceConfiguration.Cloud.cscfg";
  String csdefFileName="ServiceDefinition.csdef";
  cscfgFile.setDeploymentName(azureHostedServiceName);
  cscfgFile.setServices(services);
  cscfgFile.setBlobStoreAccountCredentials(storageAccount,storageAccessKey);
  cscfgFile.setRdpLoginCredentials(rdpLoginUsername,rdpLoginEncryptedPassword);
  csdefFile.setDeploymentName(azureHostedServiceName);
  csdefFile.setServices(services);
  logger.log(Level.INFO,"Creating updated ServiceConfiguration.Cloud.cscfg");
  cscfgFile.writeTo(new File(outDirectory,cscfgFileName));
  csdefFile.writeTo(new File(outDirectory,csdefFileName));
  return cspkg;
}
