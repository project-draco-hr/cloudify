{
  logger.fine(getThreadIdentity() + "Creating cloud cervice");
  CreateHostedService createHostedService=requestBodyBuilder.buildCreateCloudService(affinityGroup);
  String serviceName=null;
  try {
    String xmlRequest=MicrosoftAzureModelUtils.marshall(createHostedService,false);
    ClientResponse response=doPost("/services/hostedservices",xmlRequest);
    String requestId=extractRequestId(response);
    waitForRequestToFinish(requestId,endTime);
    serviceName=createHostedService.getServiceName();
    logger.fine(getThreadIdentity() + "Cloud cervice created : " + serviceName);
  }
 catch (  final Exception e) {
    logger.warning("Failed to create cloud service : " + e.getMessage());
    if (e instanceof MicrosoftAzureException) {
      throw new MicrosoftAzureException(e);
    }
    if (e instanceof TimeoutException) {
      throw new TimeoutException(e.getMessage());
    }
    if (e instanceof InterruptedException) {
      throw new InterruptedException(e.getMessage());
    }
  }
  return serviceName;
}
