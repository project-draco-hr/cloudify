{
  CreateAffinityGroup createAffinityGroup=requestBodyBuilder.buildCreateAffinity(affinityGroup,location);
  if (affinityExists(affinityGroup)) {
    logger.fine("Found an existing affinity group : " + affinityGroup);
    return;
  }
  logger.fine("creating affinity group : " + affinityGroup);
  String xmlRequest=MicrosoftAzureModelUtils.marshall(createAffinityGroup,false);
  ClientResponse response=doPost("/affinitygroups",xmlRequest);
  String requestId=extractRequestId(response);
  waitForRequestToFinish(requestId,endTime);
  logger.fine("created affinity group : " + affinityGroup);
}
