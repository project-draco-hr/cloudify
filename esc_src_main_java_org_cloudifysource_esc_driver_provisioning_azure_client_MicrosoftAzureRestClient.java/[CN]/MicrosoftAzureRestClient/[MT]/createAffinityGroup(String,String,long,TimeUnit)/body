{
  CreateAffinityGroup createAffinityGroup=requestBodyBuilder.buildCreateAffinity(affinityGroup,location);
  if (affinityExists(affinityGroup)) {
    logger.fine("Found an existing affinity group : " + affinityGroup);
    return;
  }
  String xmlRequest=MicrosoftAzureModelUtils.marshall(createAffinityGroup,false);
  ClientResponse response=doPost("/" + subscriptionId + "/affinitygroups",xmlRequest);
  String requestId=extractRequestId(response);
  waitForRequestToFinish(requestId,timeout,timeunit);
  logger.fine("created affinity group : " + affinityGroup);
}
