{
  String diskName=null;
  String roleName=null;
  try {
    Disks disks=listOSDisks();
    for (    Disk disk : disks) {
      AttachedTo attachedTo=disk.getAttachedTo();
      if (attachedTo != null) {
        if (cloudServiceName.equals(attachedTo.getHostedServiceName())) {
          diskName=disk.getName();
          roleName=attachedTo.getRoleName();
          break;
        }
      }
    }
    if (cloudServiceExists(cloudServiceName)) {
      logger.fine("Deleting deployment " + deploymentName + " from cloud service "+ cloudServiceName);
      deleteDeployment(cloudServiceName,deploymentName,endTime);
      logger.fine("Deleteing cloud service : " + cloudServiceName + " that was dedicated for virtual machine "+ roleName);
      deleteCloudService(cloudServiceName,endTime);
    }
    if (diskName != null) {
      logger.fine("Deleting OS Disk : " + diskName + " that belonged to the virtual machine "+ roleName);
      deleteOSDisk(diskName,endTime);
    }
  }
 catch (  final MicrosoftAzureException e) {
    logger.severe(ExceptionUtils.getFullStackTrace(e));
    throw e;
  }
catch (  final TimeoutException e) {
    logger.severe(ExceptionUtils.getFullStackTrace(e));
    throw e;
  }
catch (  final InterruptedException e) {
    logger.severe(ExceptionUtils.getFullStackTrace(e));
    throw e;
  }
}
