{
  JCloudsDeployer deployer=null;
  try {
    deployer=new JCloudsDeployer(config.getProvider(),config.getUser(),config.getApiKey());
    deployer.setMinRamMegabytes((int)config.getMachineMemoryMB());
    deployer.setImageId(config.getImageId());
    deployer.setHardwareId(config.getHardwareId());
    NodeMetadata server=null;
    System.out.println("Checking if server already exists.");
    server=deployer.getServerByTag(name);
    if (server != null) {
      if (server.getPrivateAddresses().isEmpty()) {
        throw new IllegalArgumentException("A server with tag " + name + " already exists, but its private adresses are not available");
      }
      final String locator=(String)server.getPrivateAddresses().toArray()[0];
      System.out.println("Server " + name + " already exists, locator = "+ locator);
      return locator;
    }
    final NodeMetadata rackspaceServer=ElasticProcessingUnitCloudDemo.createESMServer(deployer,name,details);
    if (rackspaceServer == null) {
      throw new IllegalStateException("Failed to start GigaSpaces server!");
    }
    final String locator=(String)rackspaceServer.getPrivateAddresses().toArray()[0];
    return locator;
  }
  finally {
    if (deployer != null) {
      deployer.destroy();
    }
  }
}
