{
  MachineDetails machineDetails=new MachineDetails();
  machineDetails.setAgentRunning(false);
  machineDetails.setCloudifyInstalled(false);
  machineDetails.setInstallationDirectory(null);
  machineDetails.setMachineId(customNode.getId());
  machineDetails.setPrivateAddress(customNode.getPrivateIP());
  machineDetails.setPublicAddress(customNode.getPublicIP());
  if (!StringUtils.isBlank(customNode.getUsername()) && !StringUtils.isBlank(customNode.getCredential())) {
    machineDetails.setRemoteUsername(customNode.getUsername());
    machineDetails.setRemotePassword(customNode.getCredential());
  }
 else   if (!StringUtils.isBlank(template.getUsername()) && !StringUtils.isBlank(template.getPassword())) {
    machineDetails.setRemoteUsername(template.getUsername());
    machineDetails.setRemotePassword(template.getPassword());
  }
 else {
    String nodeStr=customNode.toString();
    logger.severe("Cloud node loading failed, missing credentials for server: " + nodeStr);
    publishEvent("prov_node_loading_failed",nodeStr);
    throw new CloudProvisioningException("Cloud node loading failed, missing credentials for server: " + nodeStr);
  }
  machineDetails.setRemoteExecutionMode(template.getRemoteExecution());
  machineDetails.setFileTransferMode(template.getFileTransfer());
  return machineDetails;
}
