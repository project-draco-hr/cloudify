{
  NodeMetadata node;
  try {
    node=deployer.createServer(machineName);
  }
 catch (  final InstallerException e) {
    throw new CloudProvisioningException("Failed to create cloud machine",e);
  }
  logger.fine("New machine is starting");
  try {
    final MachineDetails md=createMachineDetailsFromNode(node);
    handleServerCredentials(node,md);
    waitUntilServerIsActive(node.getId(),Utils.millisUntil(end),TimeUnit.MILLISECONDS);
    return md;
  }
 catch (  final Exception e) {
    logger.log(Level.SEVERE,"Cloud machine was started but an error occured during initialization. Shutting down machine",e);
    this.deployer.shutdownMachine(node.getId());
    throw e;
  }
}
