{
  final NodeMetadata node;
  final MachineDetails machineDetails;
  try {
    logger.info("Cloudify Deployer is creating a new server with tag: " + groupName + ". This may take a few minutes");
    node=deployer.createServer(groupName);
  }
 catch (  final InstallerException e) {
    throw new CloudProvisioningException("Failed to create cloud server",e);
  }
  logger.info("New node is allocated, group name: " + groupName);
  machineDetails=createMachineDetailsFromNode(node);
  try {
    handleServerCredentials(machineDetails);
    waitUntilServerIsActive(machineDetails.getMachineId(),Utils.millisUntil(end),TimeUnit.MILLISECONDS);
  }
 catch (  final Exception e) {
    logger.log(Level.SEVERE,"Cloud machine was started but an error occured during initialization. Shutting down machine",e);
    deployer.shutdownMachine(node.getId());
    throw new CloudProvisioningException(e);
  }
  return machineDetails;
}
