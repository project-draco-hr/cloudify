{
  try {
    this.deployer=(JCloudsDeployer)context.getOrCreate("UNIQUE_JCLOUDS_DEPLOYER_ID_" + this.cloudTemplateName,new Callable<Object>(){
      @Override public Object call() throws Exception {
        logger.fine("Creating JClouds context deployer with user: " + cloud.getUser().getUser());
        final CloudTemplate cloudTemplate=cloud.getTemplates().get(cloudTemplateName);
        logger.fine("Cloud Template: " + cloudTemplateName + ". Details: "+ cloudTemplate);
        final Properties props=new Properties();
        props.putAll(cloudTemplate.getOverrides());
        deployer=new JCloudsDeployer(cloud.getProvider().getProvider(),cloud.getUser().getUser(),cloud.getUser().getApiKey(),props);
        deployer.setImageId(cloudTemplate.getImageId());
        deployer.setMinRamMegabytes(cloudTemplate.getMachineMemoryMB());
        deployer.setHardwareId(cloudTemplate.getHardwareId());
        deployer.setLocationId(cloudTemplate.getLocationId());
        deployer.setExtraOptions(cloudTemplate.getOptions());
        return deployer;
      }
    }
);
  }
 catch (  final Exception e) {
    publishEvent("connection_to_cloud_api_failed",cloud.getProvider().getProvider());
    throw new IllegalStateException("Failed to create cloud Deployer",e);
  }
}
