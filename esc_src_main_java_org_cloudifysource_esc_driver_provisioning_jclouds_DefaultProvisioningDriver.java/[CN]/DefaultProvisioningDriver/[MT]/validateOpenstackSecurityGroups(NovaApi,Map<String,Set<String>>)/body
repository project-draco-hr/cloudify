{
  Set<String> missingSecurityGroups=new HashSet<String>();
  for (  Entry<String,Set<String>> mapEntry : securityGroupsByRegions.entrySet()) {
    String region=mapEntry.getKey();
    SecurityGroupApi securityGroupApi=novaApi.getSecurityGroupExtensionForZone(region).get();
    for (    String securityGroupName : mapEntry.getValue()) {
      Predicate<org.jclouds.openstack.nova.v2_0.domain.SecurityGroup> securityGroupNamePredicate=org.jclouds.openstack.nova.v2_0.predicates.SecurityGroupPredicates.nameEquals(securityGroupName);
      if (!securityGroupApi.list().anyMatch(securityGroupNamePredicate)) {
        missingSecurityGroups.add(securityGroupName);
      }
    }
  }
  if (missingSecurityGroups.size() == 1) {
    throw new CloudProvisioningException("Invalid security group name: " + missingSecurityGroups.iterator().next());
  }
 else   if (missingSecurityGroups.size() > 1) {
    throw new CloudProvisioningException("Invalid security group names: " + Arrays.toString(missingSecurityGroups.toArray()));
  }
}
