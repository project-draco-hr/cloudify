{
  final Set<? extends NodeMetadata> existingManagementServers=this.deployer.getServers(new Predicate<ComputeMetadata>(){
    @Override public boolean apply(    final ComputeMetadata input){
      final NodeMetadata node=(NodeMetadata)input;
      if (node.getGroup() == null) {
        return false;
      }
      if (!(node.getState() == NodeState.RUNNING || node.getState() == NodeState.PENDING)) {
        return false;
      }
      return node.getGroup().toLowerCase().startsWith(managementMachinePrefix.toLowerCase());
    }
  }
);
  final MachineDetails[] result=new MachineDetails[existingManagementServers.size()];
  int i=0;
  for (  final NodeMetadata node : existingManagementServers) {
    result[i]=createMachineDetailsFromNode(node);
    result[i].setAgentRunning(true);
    result[i].setCloudifyInstalled(true);
    i++;
  }
  return result;
}
