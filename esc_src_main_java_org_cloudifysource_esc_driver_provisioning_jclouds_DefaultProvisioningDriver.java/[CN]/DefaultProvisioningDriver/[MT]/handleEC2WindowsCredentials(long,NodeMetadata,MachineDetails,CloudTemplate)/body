{
  final File pemFile=new File(this.cloud.getUser().getKeyFile());
  logger.info("PEM file is located at: " + pemFile);
  if (!pemFile.exists()) {
    logger.severe("Could not find pem file: " + pemFile);
    throw new FileNotFoundException("Could not find key file: " + pemFile);
  }
  logger.info("PEM file exists!");
  String password;
  if (cloudTemplate.getPassword() == null) {
    final LoginCredentials credentials=new EC2WindowsPasswordHandler().getPassword(node,this.deployer.getContext(),end,pemFile);
    password=credentials.getPassword();
  }
 else {
    password=cloudTemplate.getPassword();
  }
  String username=cloudTemplate.getUsername();
  if (username == null) {
    username=cloud.getConfiguration().getRemoteUsername();
  }
  if (username == null) {
    username=DEFAULT_EC2_WINDOWS_USERNAME;
  }
  machineDetails.setRemoteUsername(username);
  machineDetails.setRemotePassword(password);
  machineDetails.setFileTransferMode(cloudTemplate.getFileTransfer());
  machineDetails.setRemoteExecutionMode(cloudTemplate.getRemoteExecution());
}
