{
  final String baseDirectory=this.management ? Environment.getHomeDirectory() : this.cloud.getProvider().getRemoteDirectory();
  final File localDirectory=new File(baseDirectory,this.cloud.getProvider().getLocalDirectory());
  final File pemFile=new File(localDirectory,this.cloud.getUser().getKeyFile());
  logger.fine("PEM file is located at: " + pemFile);
  if (!pemFile.exists()) {
    logger.severe("Could not find pem file: " + pemFile);
    throw new FileNotFoundException("Could not find key file: " + pemFile);
  }
  String password;
  if (cloudTemplate.getPassword() == null) {
    final LoginCredentials credentials=new EC2WindowsPasswordHandler().getPassword(node,this.deployer.getContext(),end,pemFile);
    password=credentials.getPassword();
  }
 else {
    password=cloudTemplate.getPassword();
  }
  String username=cloudTemplate.getUsername();
  if (username == null) {
    username=cloud.getConfiguration().getRemoteUsername();
  }
  if (username == null) {
    username=DEFAULT_EC2_WINDOWS_USERNAME;
  }
  machineDetails.setRemoteUsername(username);
  machineDetails.setRemotePassword(password);
  machineDetails.setFileTransferMode(cloudTemplate.getFileTransfer());
  machineDetails.setRemoteExecutionMode(cloudTemplate.getRemoteExecution());
}
