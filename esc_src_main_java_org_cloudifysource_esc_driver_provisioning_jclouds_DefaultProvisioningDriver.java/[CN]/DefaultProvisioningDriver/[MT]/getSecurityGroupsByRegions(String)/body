{
  Map<String,Set<String>> securityGroupsByRegions=new HashMap<String,Set<String>>();
  for (  ComputeTemplate template : cloud.getCloudCompute().getTemplates().values()) {
    String locationId=template.getLocationId();
    if (StringUtils.isBlank(locationId)) {
      locationId=defaultLocationId;
    }
    Object securityGroupsArr=template.getOptions().get("securityGroupNames");
    if (securityGroupsArr == null) {
      securityGroupsArr=template.getOptions().get("securityGroups");
    }
    if (securityGroupsArr != null && securityGroupsArr instanceof String[]) {
      Set<String> securityGroupNames=new HashSet<String>();
      for (      String securityGroupName : (String[])securityGroupsArr) {
        securityGroupNames.add(securityGroupName);
      }
      Set<String> groupsForRegion=securityGroupsByRegions.get(locationId);
      if (groupsForRegion == null) {
        securityGroupsByRegions.put(locationId,securityGroupNames);
      }
 else {
        groupsForRegion.addAll(securityGroupNames);
        securityGroupsByRegions.put(locationId,groupsForRegion);
      }
    }
  }
  return securityGroupsByRegions;
}
