{
  Set<String> missingKeyPairs=new HashSet<String>();
  for (  Entry<String,Set<String>> mapEntry : keyPairsByRegions.entrySet()) {
    String region=mapEntry.getKey();
    KeyPairApi keyPairApi=novaApi.getKeyPairExtensionForZone(region).get();
    for (    String keyPairName : mapEntry.getValue()) {
      Predicate<org.jclouds.openstack.nova.v2_0.domain.KeyPair> keyPairNamePredicate=org.jclouds.openstack.nova.v2_0.predicates.KeyPairPredicates.nameEquals(keyPairName);
      if (!keyPairApi.list().anyMatch(keyPairNamePredicate)) {
        missingKeyPairs.add(keyPairName);
      }
    }
  }
  if (missingKeyPairs.size() == 1) {
    throw new CloudProvisioningException("Invalid key-pair name: " + missingKeyPairs.iterator().next());
  }
 else   if (missingKeyPairs.size() > 1) {
    throw new CloudProvisioningException("Invalid key-pair names: " + Arrays.toString(missingKeyPairs.toArray()));
  }
}
