{
  boolean hasExtendedServices=false;
  for (  final Service service : application.getServices()) {
    if (!service.getExtendedServicesPaths().isEmpty()) {
      hasExtendedServices=true;
      break;
    }
  }
  File applicationFolderToPack=applicationDir;
  if (hasExtendedServices) {
    final File destApplicationFolder=File.createTempFile("gs_application_","");
    FileUtils.forceDelete(destApplicationFolder);
    FileUtils.forceMkdir(destApplicationFolder);
    FileUtils.copyDirectory(applicationDir,destApplicationFolder,SVNFileFilter.getFilter());
    for (    final Service service : application.getServices()) {
      final File extFolder=new File(destApplicationFolder + "/" + service.getName());
      final File recipeFile=DSLReader.findDefaultDSLFile(DSLReader.SERVICE_DSL_FILE_NAME_SUFFIX,new File(applicationDir + "/" + service.getName()));
      copyExtendedServiceFiles(service,recipeFile,extFolder);
    }
    applicationFolderToPack=destApplicationFolder;
  }
  final File zipFile=File.createTempFile("application",".zip");
  zipFile.deleteOnExit();
  ZipUtils.zip(applicationFolderToPack,zipFile);
  return zipFile;
}
