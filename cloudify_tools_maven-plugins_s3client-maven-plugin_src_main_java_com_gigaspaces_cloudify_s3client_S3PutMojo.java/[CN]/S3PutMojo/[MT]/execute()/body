{
  BlobStoreContext context=null;
  try {
    Set<Module> wiring=new HashSet<Module>();
    context=new BlobStoreContextFactory().createContext("aws-s3",user,key,wiring,new Properties());
    BlobStore store=context.getBlobStore();
    Blob newBlob=store.blobBuilder(target).payload(source).build();
    getLog().info("upload size is: " + source.length());
    getLog().info("waiting for upload to end");
    store.putBlob(container,newBlob);
    if (publicUrl != null && Boolean.parseBoolean(publicUrl)) {
      S3Client client=S3Client.class.cast(context.getProviderSpecificContext().getApi());
      String ownerId=client.getObjectACL(container,target).getOwner().getId();
      client.putObjectACL(container,target,AccessControlList.fromCannedAccessPolicy(CannedAccessPolicy.PUBLIC_READ,ownerId));
    }
  }
 catch (  Exception e) {
    throw new MojoFailureException("Failed put operation",e);
  }
 finally {
    if (context != null) {
      context.close();
    }
  }
}
