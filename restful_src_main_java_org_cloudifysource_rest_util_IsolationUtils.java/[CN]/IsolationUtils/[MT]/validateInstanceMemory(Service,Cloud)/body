{
  if (service == null) {
    return;
  }
  if (isDedicated(service)) {
    return;
  }
  String serviceTemplate=null;
  if (service.getCompute() != null) {
    serviceTemplate=service.getCompute().getTemplate();
  }
  if (serviceTemplate == null) {
    serviceTemplate=cloud.getTemplates().entrySet().iterator().next().getKey();
  }
  int machineTemplateMemory=cloud.getTemplates().get(serviceTemplate).getMachineMemoryMB();
  int reservedMachineMemory=cloud.getProvider().getReservedMemoryCapacityPerMachineInMB();
  long instanceMemoryMB=getInstanceMemoryMB(service);
  if (instanceMemoryMB > (machineTemplateMemory - reservedMachineMemory)) {
    throw new RestErrorException(CloudifyErrorMessages.INSUFFICIENT_MEMORY.getName(),"Cannot install service " + service.getName() + ". The requested meomry was "+ instanceMemoryMB+ ", while the machine memory is "+ machineTemplateMemory+ " and the reserved is "+ reservedMachineMemory);
  }
}
