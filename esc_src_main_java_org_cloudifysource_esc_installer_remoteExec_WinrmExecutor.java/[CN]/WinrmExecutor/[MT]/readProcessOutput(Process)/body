{
  final StringBuilder sb=new StringBuilder();
  final BufferedReader reader=new BufferedReader(new InputStreamReader(p.getInputStream()));
  try {
    final String newline=System.getProperty("line.separator");
    while (true) {
      final String line=reader.readLine();
      if (line == null) {
        break;
      }
      installer.publishEvent("powershell_output_line",line);
      logger.fine(line);
      sb.append(line).append(newline);
    }
  }
  finally {
    try {
      reader.close();
    }
 catch (    final IOException e) {
      logger.log(Level.SEVERE,"Error while closingprocess input stream: " + e.getMessage(),e);
    }
  }
  return sb.toString();
}
