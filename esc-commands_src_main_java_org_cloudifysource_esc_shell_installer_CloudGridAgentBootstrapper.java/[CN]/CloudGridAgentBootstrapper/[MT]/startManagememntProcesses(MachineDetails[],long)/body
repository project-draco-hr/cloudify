{
  final AgentlessInstaller installer=new AgentlessInstaller();
  installer.addListener(new CliAgentlessInstallerListener(this.verbose));
  Logger.getLogger(AgentlessInstaller.SSH_LOGGER_NAME).setLevel(Level.parse(cloud.getProvider().getSshLoggingLevel()));
  final CloudTemplate template=cloud.getTemplates().get(cloud.getConfiguration().getManagementMachineTemplate());
  final int numOfManagementMachines=machines.length;
  final InstallationDetails[] installations=createInstallationDetails(numOfManagementMachines,machines,template);
  for (int i=1; i < installations.length; i++) {
    installations[i].setNoWebServices(true);
  }
  final String lookup=createLocatorsString(installations);
  for (  final InstallationDetails detail : installations) {
    detail.setLocator(lookup);
  }
  final File uploadDir=new File(template.getLocalDirectory());
  try {
    FileUtils.copyFileToDirectory(this.cloudFile,uploadDir);
    installOnMachines(endTime,installer,numOfManagementMachines,installations);
  }
  finally {
    FileUtils.forceDelete(new File(uploadDir,this.cloudFile.getName()));
  }
  return machines;
}
