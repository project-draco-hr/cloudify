{
  boolean hasExtendedServices=false;
  for (  Service service : application.getServices()) {
    if (!service.getExtendedServicesPaths().isEmpty()) {
      hasExtendedServices=true;
      break;
    }
  }
  File applicationFolderToPack=applicationDir;
  if (hasExtendedServices) {
    File destApplicationFolder=File.createTempFile("gs_application_","");
    FileUtils.forceDelete(destApplicationFolder);
    FileUtils.forceMkdir(destApplicationFolder);
    FileUtils.copyDirectory(applicationDir,destApplicationFolder,SVNFileFilter.getFilter());
    for (    Service service : application.getServices()) {
      File extFolder=new File(destApplicationFolder + "/" + service.getName());
      File recipeFile=ServiceReader.findServiceFile(new File(applicationDir + "/" + service.getName()));
      copyExtendedServiceFiles(service,recipeFile,extFolder);
    }
    applicationFolderToPack=destApplicationFolder;
  }
  File zipFile=File.createTempFile("application",".zip");
  zipFile.deleteOnExit();
  ZipUtils.zip(applicationFolderToPack,zipFile);
  return zipFile;
}
