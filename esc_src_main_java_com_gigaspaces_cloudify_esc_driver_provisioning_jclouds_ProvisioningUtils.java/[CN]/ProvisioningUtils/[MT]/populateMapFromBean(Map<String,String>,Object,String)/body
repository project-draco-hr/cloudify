{
  if (bean == null) {
    return;
  }
  if (List.class.isAssignableFrom(bean.getClass())) {
    List<Object> list=(List<Object>)bean;
    int index=0;
    for (    Object object : list) {
      populateMapFromBean(map,object,keyPrefix + "." + index);
      ++index;
    }
  }
 else   if (Map.class.isAssignableFrom(bean.getClass())) {
    Map<String,Object> propertyMap=(Map<String,Object>)bean;
    Set<Entry<String,Object>> entries=propertyMap.entrySet();
    for (    Entry<String,Object> propertyEntry : entries) {
      populateMapFromBean(map,propertyEntry.getValue(),keyPrefix + "." + propertyEntry.getKey());
    }
  }
 else {
    if (org.springframework.beans.BeanUtils.isSimpleProperty(bean.getClass())) {
      if (!Class.class.isAssignableFrom(bean.getClass())) {
        map.put(keyPrefix,bean.toString());
      }
    }
 else {
      Map<String,Object> propertyMap=PropertyUtils.describe(bean);
      Set<Entry<String,Object>> entries=propertyMap.entrySet();
      for (      Entry<String,Object> entry : entries) {
        if (keyPrefix.length() == 0) {
          populateMapFromBean(map,entry.getValue(),entry.getKey());
        }
 else {
          populateMapFromBean(map,entry.getValue(),keyPrefix + "." + entry.getKey());
        }
      }
    }
  }
}
