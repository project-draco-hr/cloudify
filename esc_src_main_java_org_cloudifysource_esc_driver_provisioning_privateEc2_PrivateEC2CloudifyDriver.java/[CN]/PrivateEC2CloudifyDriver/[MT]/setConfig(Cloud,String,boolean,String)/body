{
  logger.fine("Running path : " + System.getProperty("user.dir"));
  this.serviceName=this.getSimpleServiceName(fullServiceName);
  this.cloudTemplateName=cloudTemplateName;
  this.cloudName=cloud.getName();
  super.setConfig(cloud,cloudTemplateName,management,fullServiceName);
  if (logger.isLoggable(Level.FINER)) {
    logger.finer("Service name : " + this.serviceName + "("+ fullServiceName+ ")");
  }
  try {
    ComputeTemplate managerTemplate=this.getManagerComputeTemplate();
    if (management) {
      managerCfnTemplateFileName=(String)managerTemplate.getCustom().get("cfnManagerTemplate");
    }
 else {
      this.privateEc2Template=cfnTemplatePerService.get(this.serviceName);
      if (this.privateEc2Template == null) {
        throw new IllegalArgumentException("CFN template not found for service:" + fullServiceName);
      }
    }
    this.ec2=this.createAmazonEC2();
    String locationId=(String)managerTemplate.getCustom().get("s3LocationId");
    CloudUser user=this.cloud.getUser();
    this.amazonS3Uploader=new AmazonS3Uploader(user.getUser(),user.getApiKey(),locationId);
  }
 catch (  final CloudProvisioningException e) {
    throw new IllegalArgumentException(e);
  }
}
