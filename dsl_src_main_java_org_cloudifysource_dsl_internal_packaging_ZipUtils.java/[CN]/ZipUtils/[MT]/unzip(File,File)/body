{
  ZipFile zfile=new ZipFile(zipfile);
  Enumeration<? extends ZipEntry> entries=zfile.entries();
  while (entries.hasMoreElements()) {
    ZipEntry entry=entries.nextElement();
    File file=new File(directory,entry.getName());
    if (entry.isDirectory()) {
      boolean mkdirs=file.mkdirs();
      if (!mkdirs) {
        zfile.close();
        throw new IllegalStateException("cant create dir" + file.getAbsolutePath());
      }
    }
 else {
      if (!file.getParentFile().exists()) {
        boolean mkdirs=file.getParentFile().mkdirs();
        if (!mkdirs) {
          zfile.close();
          throw new IllegalStateException("cant create dir" + file.getParentFile().getAbsolutePath());
        }
      }
      InputStream in=zfile.getInputStream(entry);
      try {
        copy(in,file);
      }
  finally {
        in.close();
      }
    }
  }
}
