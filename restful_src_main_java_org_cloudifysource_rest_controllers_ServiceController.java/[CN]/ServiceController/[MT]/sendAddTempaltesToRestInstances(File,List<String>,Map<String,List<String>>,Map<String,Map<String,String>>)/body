{
  ProcessingUnitInstance[] instances=admin.getProcessingUnits().waitFor("rest",RestUtils.TIMEOUT_IN_SECOND,TimeUnit.SECONDS).getInstances();
  logger.log(Level.INFO,"addTemplates - sending templates folder to " + instances.length + " instances.");
  for (  ProcessingUnitInstance puInstance : instances) {
    String hostAddress=puInstance.getMachine().getHostAddress();
    String host=puInstance.getMachine().getHostName() + "/" + hostAddress;
    Map<String,Object> response;
    try {
      logger.log(Level.INFO,"addTemplates - sending add templates request to " + host + ", post file: "+ templatesFolder.getName());
      response=executePostRestRequest(templatesFolder,puInstance,"/service/templates/internal");
    }
 catch (    Exception e) {
      logger.log(Level.WARNING,"addTemplates - failed to execute http request to " + host + ". Error: "+ e,e);
      Map<String,String> expectedMap=new HashMap<String,String>();
      for (      String expectedTempalte : expectedTemplates) {
        String errorMessage=e.getMessage();
        if (errorMessage == null) {
          errorMessage=e.toString();
        }
        expectedMap.put(expectedTempalte,errorMessage);
      }
      failedToAddTemplatesByHost.put(host,expectedMap);
      continue;
    }
    Map<String,String> failedMap=(Map<String,String>)response.get(FAILED_TO_ADD_TEMPLATES_KEY);
    if (!failedMap.isEmpty()) {
      failedToAddTemplatesByHost.put(host,failedMap);
    }
    List<String> addedTemplates=(List<String>)response.get(SUCCESSFULLY_ADDED_TEMPLATES_KEY);
    if (!addedTemplates.isEmpty()) {
      addedTemplatesByHost.put(host,addedTemplates);
    }
    if (!expectedTemplates.equals(addedTemplates)) {
      logger.log(Level.WARNING,"addTemplates - failed to add templates to " + host + ", expected list: "+ expectedTemplates.toString()+ ", actual list: "+ addedTemplates.toString());
    }
    logger.log(Level.INFO,"addTemplates - successfully added " + addedTemplates.size() + " templates to "+ host+ ": "+ addedTemplates);
  }
}
