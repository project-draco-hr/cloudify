{
  ProcessingUnit processingUnit=admin.getProcessingUnits().waitFor("rest",RestUtils.TIMEOUT_IN_SECOND,TimeUnit.SECONDS);
  ProcessingUnitInstance[] instances=processingUnit.getInstances();
  File localTemplateFolder=ServiceReader.unzipCloudTemplatesFolder(copyMultipartFileToLocalFile(templatesFolder));
  try {
    List<String> expectedTemplatesList=addTemplatesToCloud(localTemplateFolder,InetAddress.getLocalHost().getHostAddress());
    logger.log(Level.INFO,"addTemplates - sending templates folder to " + (instances.length - 1) + " rest instances.");
    for (    ProcessingUnitInstance puInstance : instances) {
      InetAddress puInstanceAddress=InetAddress.getByName(puInstance.getMachine().getHostName());
      if (!(RestUtils.isLocalHost(puInstanceAddress))) {
        String hostAddress=puInstance.getMachine().getHostAddress();
        String address=hostAddress + ":" + puInstance.getJeeDetails().getPort();
        address="localhost:8080/rest";
        List<String> addedTemplates=executeRestRequest(templatesFolder,address);
        if (!expectedTemplatesList.equals(addedTemplates)) {
          logger.log(Level.INFO,"addTemplates RestErrorException - failed_to_add_templates:\n" + "to ip " + hostAddress + "(host name: "+ puInstance.getMachine().getHostName()+ "), from templates folder: "+ localTemplateFolder.getAbsolutePath()+ ", expected list: "+ expectedTemplatesList.toString()+ ", actual list: "+ addedTemplates.toString());
          throw new RestErrorException("failed_to_add_templates",hostAddress,localTemplateFolder.getAbsolutePath(),expectedTemplatesList.toString(),addedTemplates.toString());
        }
        logger.log(Level.INFO,"addTemplates - added " + addedTemplates.size() + " templates to REST host address "+ hostAddress);
      }
    }
    return successStatus(expectedTemplatesList);
  }
  finally {
    localTemplateFolder.delete();
  }
}
