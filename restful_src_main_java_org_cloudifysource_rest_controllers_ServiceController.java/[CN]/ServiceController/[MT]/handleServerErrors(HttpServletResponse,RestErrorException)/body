{
  if (response.isCommitted()) {
    logger.log(Level.WARNING,"Caught exception, but response already commited. Not sending error message based on exception",e);
  }
 else {
    response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
    final ServletOutputStream outputStream=response.getOutputStream();
    Map<String,Object> errorDescriptionMap=e.getErrorDescription();
    String mapAsJson=new ObjectMapper().writeValueAsString(errorDescriptionMap);
    logger.log(Level.INFO,"caught exception. Sending response message " + (String)errorDescriptionMap.get("error"),e);
    final byte[] messageBytes=mapAsJson.getBytes();
    outputStream.write(messageBytes);
  }
}
