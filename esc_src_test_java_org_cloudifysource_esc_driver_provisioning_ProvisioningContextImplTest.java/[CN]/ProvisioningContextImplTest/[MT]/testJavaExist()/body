{
  Cloud cloud=new Cloud();
  cloud.setProvider(new CloudProvider());
  cloud.getProvider().setManagementOnlyFiles(new ArrayList<String>());
  ComputeTemplate template=new ComputeTemplate();
  template.setJavaUrl(HTTP_JAVA_URL);
  cloud.getConfiguration().setManagementMachineTemplate(TEMPLATE_NAME);
  cloud.getCloudCompute().setTemplates(new LinkedHashMap<String,ComputeTemplate>());
  cloud.getCloudCompute().getTemplates().put(TEMPLATE_NAME,template);
  cloud.getConfiguration().getComponents().getRest().setPort(8100);
  cloud.getConfiguration().getComponents().getWebui().setPort(8099);
  cloud.getConfiguration().getComponents().getDiscovery().setDiscoveryPort(4172);
  final ProvisioningContextImpl ctx=new ProvisioningContextImpl();
  ctx.setLocationId(null);
  InstallationDetailsBuilder builder=ctx.getInstallationDetailsBuilder();
  builder.setReservationId(null);
  builder.setAdmin(null);
  builder.setAuthGroups(null);
  builder.setCloud(cloud);
  builder.setCloudFile(new File("some-cloud.groovy"));
  builder.setKeystorePassword(null);
  builder.setLookupLocators(null);
  builder.setManagement(true);
  builder.setRebootstrapping(false);
  builder.setReservationId(null);
  builder.setSecurityProfile("");
  builder.setTemplate(cloud.getCloudCompute().getTemplates().get(cloud.getConfiguration().getManagementMachineTemplate()));
  builder.setTemplateName(cloud.getConfiguration().getManagementMachineTemplate());
  builder.setZones(new HashSet<String>(Arrays.asList("management")));
  MachineDetails md=new MachineDetails();
  md.setAgentRunning(true);
  md.setFileTransferMode(FileTransferModes.SFTP);
  md.setPrivateAddress("10.10.10.10");
  md.setPublicAddress("20.20.20.20");
  md.setRemoteExecutionMode(RemoteExecutionModes.SSH);
  final MachineDetails[] mds=new MachineDetails[]{md};
  final String[] results=ctx.createManagementEnvironmentScript(mds,template);
  Assert.assertEquals(1,results.length);
  final String result=results[0];
  System.out.println(result);
  Assert.assertTrue("java url not found",result.contains(HTTP_JAVA_URL));
}
