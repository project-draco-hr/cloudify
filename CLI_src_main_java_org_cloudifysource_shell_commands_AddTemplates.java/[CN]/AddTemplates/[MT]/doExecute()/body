{
  String templatesFolderName=templatesFileOrDir.getName();
  String templatesPath=templatesFileOrDir.getAbsolutePath();
  logger.info("Validating tempaltes folder and files: " + templatesPath);
  if (!templatesFileOrDir.exists()) {
    throw new CLIStatusException("templates_file_not_found",templatesPath);
  }
  int numTemplatesInFolder;
  File zipFile=templatesFileOrDir;
  CloudTemplatesReader reader=new CloudTemplatesReader();
  if (templatesFileOrDir.isFile()) {
    if (templatesFolderName.endsWith(".zip") || templatesFolderName.endsWith(".jar")) {
      try {
        numTemplatesInFolder=reader.readCloudTemplatesFromZip(templatesFileOrDir).size();
      }
 catch (      DSLException e) {
        throw new CLIStatusException("read_dsl_file_failed",templatesPath,e.getMessage());
      }
    }
 else {
      if (!templatesFolderName.endsWith(DSLUtils.TEMPLATE_DSL_FILE_NAME_SUFFIX)) {
        throw new CLIStatusException("illegal_template_file_name",templatesFolderName);
      }
      File parentFile=templatesFileOrDir.getParentFile();
      File[] actualTemplatesDslFiles=DSLReader.findDefaultDSLFiles(DSLUtils.TEMPLATE_DSL_FILE_NAME_SUFFIX,parentFile);
      if (actualTemplatesDslFiles.length > 1) {
        throw new CLIStatusException("too_many_template_files",Arrays.toString(actualTemplatesDslFiles));
      }
      try {
        numTemplatesInFolder=reader.readCloudTemplatesFromFile(templatesFileOrDir).size();
      }
 catch (      DSLException e) {
        throw new CLIStatusException("read_dsl_file_failed",templatesPath,e.getMessage());
      }
      if (numTemplatesInFolder == 0) {
        throw new CLIStatusException("no_template_files",templatesPath);
      }
      zipFile=Packager.createZipFile("templates",parentFile);
    }
  }
 else {
    try {
      numTemplatesInFolder=reader.readCloudTemplatesFromDirectory(templatesFileOrDir).size();
      if (numTemplatesInFolder == 0) {
        throw new CLIStatusException("no_template_files",templatesPath);
      }
    }
 catch (    DSLException e) {
      throw new CLIStatusException("read_dsl_file_failed",templatesPath,e.getMessage());
    }
    zipFile=Packager.createZipFile("templates",templatesFileOrDir);
  }
  logger.info("Adding " + numTemplatesInFolder + " templates to cloud.");
  List<String> addedTempaltes;
  try {
    addedTempaltes=adminFacade.addTempaltes(zipFile);
  }
 catch (  CLIStatusException e) {
    String reasonCode=e.getReasonCode();
    if (reasonCode.equals("failed_to_add_templates")) {
      throw new CLIStatusException(reasonCode,convertArgsToIndentJaon(e.getArgs()));
    }
 else     if (reasonCode.equals("failed_to_add_all_templates")) {
      if (e.getArgs().length > 0) {
        throw new CLIStatusException(reasonCode,getIndentMap((Map<String,Object>)e.getArgs()[0]));
      }
    }
    throw e;
  }
  return getFormattedMessage("templates_added_successfully",Color.GREEN) + getFormatedAddedTemplateNamesList(addedTempaltes);
}
