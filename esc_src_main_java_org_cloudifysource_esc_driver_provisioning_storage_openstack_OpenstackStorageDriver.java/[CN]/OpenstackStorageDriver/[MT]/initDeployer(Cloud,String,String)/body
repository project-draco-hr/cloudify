{
  if (deployer != null) {
    return deployer;
  }
  try {
    logger.fine("Creating JClouds context deployer for Openstack with user: " + cloud.getUser().getUser());
    final StorageTemplate storageTemplate=cloud.getCloudStorage().getTemplates().get(storageTemplateName);
    final ComputeTemplate computeTemplate=cloud.getCloudCompute().getTemplates().get(computeTemplateName);
    final Properties props=new Properties();
    props.putAll(computeTemplate.getOverrides());
    props.putAll(storageTemplate.getCustom());
    deployer=new JCloudsDeployer(cloud.getProvider().getProvider(),cloud.getUser().getUser(),cloud.getUser().getApiKey(),props);
  }
 catch (  final Exception e) {
    publishEvent("connection_to_cloud_api_failed",cloud.getProvider().getProvider());
    throw new IllegalStateException("Failed to create cloud Deployer",e);
  }
  return deployer;
}
