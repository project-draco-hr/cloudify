{
  final MachineDetails md=new MachineDetails();
  md.setAgentRunning(false);
  md.setCloudifyInstalled(false);
  md.setInstallationDirectory(null);
  md.setMachineId(node.getId());
  md.setPrivateAddress(node.getPrivateIP());
  md.setPublicAddress(node.getPublicIP());
  md.setUsePrivateAddress(true);
  final CloudTemplate template=this.cloud.getTemplates().get(this.cloudTemplateName);
  if (!StringUtils.isBlank(node.getUsername()) && !StringUtils.isBlank(node.getCredential())) {
    md.setRemoteUsername(node.getUsername());
    md.setRemotePassword(node.getCredential());
  }
 else   if (!StringUtils.isBlank(template.getUsername()) && !StringUtils.isBlank(template.getPassword())) {
    md.setRemoteUsername(template.getUsername());
    md.setRemotePassword(template.getPassword());
  }
 else {
    logger.severe("Cloud node loading failed, missing credentials for server: " + node.toString());
    publishEvent("prov_node_loading_failed",node.toString());
    throw new CloudProvisioningException("Cloud node loading failed, missing credentials for server: " + node.toString());
  }
  return md;
}
