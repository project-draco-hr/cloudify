{
  final CustomNode node;
  final MachineDetails machineDetails;
  try {
    logger.info("Cloudify Deployer is creating a new server with name: " + name + ". This may take a few minutes");
    node=deployer.createServer(name);
  }
 catch (  final InstallerException e) {
    throw new CloudProvisioningException("Failed to create cloud server",e);
  }
  logger.info("New node is allocated, name: " + name);
  machineDetails=createMachineDetailsFromNode(node);
  try {
    handleServerCredentials(machineDetails);
    Utils.validateConnection(machineDetails.getIp(),SSH_PORT,Utils.millisUntil(end));
  }
 catch (  final Exception e) {
    logger.log(Level.SEVERE,"Cloud machine was started but an error occured during initialization. Shutting down machine",e);
    deployer.shutdownServer(node);
    deployer.invalidateServer(node);
    throw new CloudProvisioningException(e);
  }
  return machineDetails;
}
