{
  Set<CustomNode> managementServers=null;
  try {
    managementServers=getExistingManagementServers(cloud.getProvider().getNumberOfManagementMachines());
  }
 catch (  final Exception e) {
    publishEvent("prov_management_lookup_failed");
    throw new CloudProvisioningException("Failed to lookup existing management servers.",e);
  }
  for (  final CustomNode customNode : managementServers) {
    shutdownServerGracefully(customNode,true);
  }
}
