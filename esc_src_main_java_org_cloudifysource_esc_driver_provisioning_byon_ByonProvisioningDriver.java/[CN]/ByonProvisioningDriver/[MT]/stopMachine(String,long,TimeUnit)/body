{
  boolean stopResult=false;
  logger.info("Stop Machine - machineIp: " + serverIp);
  final Long previousRequest=stoppingMachines.get(serverIp);
  if (previousRequest != null && System.currentTimeMillis() - previousRequest < MULTIPLE_SHUTDOWN_REQUEST_IGNORE_TIMEOUT) {
    logger.fine("Machine " + serverIp + " is already stopping. Ignoring this shutdown request");
    stopResult=false;
  }
 else {
    stoppingMachines.put(serverIp,System.currentTimeMillis());
    logger.info("Scale IN -- " + serverIp + " --");
    logger.info("Looking up cloud server with IP: " + serverIp);
    final CustomNode cloudNode=deployer.getServerByIP(cloudTemplateName,serverIp);
    if (cloudNode != null) {
      logger.info("Found server: " + cloudNode.getId() + ". Shutting it down and waiting for shutdown to complete");
      MachineDetails machineDetails=null;
      try {
        machineDetails=createMachineDetailsFromNode(cloudNode);
        Utils.deleteFileSystemObject(machineDetails.getPrivateAddress(),machineDetails.getRemoteUsername(),machineDetails.getRemotePassword(),"/tmp/gs-files",null,1,TimeUnit.MINUTES);
      }
 catch (      Exception e) {
        if (machineDetails != null) {
          logger.info("ByonProvisioningDriver: Failed to delete system files on teardown from server: " + machineDetails.getPrivateAddress());
        }
 else {
          logger.info("ByonProvisioningDriver: Failed to delete system files on teardown from server.");
        }
      }
      deployer.shutdownServerByIp(cloudTemplateName,cloudNode.getPrivateIP());
      logger.info("Server: " + cloudNode.getId() + " shutdown has finished.");
      stopResult=true;
    }
 else {
      logger.log(Level.SEVERE,"Recieved scale in request for machine with ip " + serverIp + " but this IP could not be found in the Cloud server list");
      stopResult=false;
    }
  }
  return stopResult;
}
