{
  final Set<CustomNode> existingManagementServers=new HashSet<CustomNode>();
  final Set<CustomNode> allNodes=deployer.getAllNodesByTemplateName(cloudTemplateName);
  String managementIP=null;
  for (  final CustomNode server : allNodes) {
    try {
      Utils.validateConnection(server.getPrivateIP(),CloudifyConstants.DEFAULT_REST_PORT);
      managementIP=server.getPrivateIP();
      break;
    }
 catch (    final Exception ex) {
    }
  }
  if (StringUtils.isNotBlank(managementIP)) {
    if (admin == null) {
      admin=Utils.getAdminObject(managementIP,expectedGsmCount);
    }
    final GridServiceManagers gsms=admin.getGridServiceManagers();
    for (    final GridServiceManager gsm : gsms) {
      final CustomNode managementServer=deployer.getServerByIP(cloudTemplateName,gsm.getMachine().getHostAddress());
      if (managementServer != null) {
        existingManagementServers.add(managementServer);
      }
    }
    admin.close();
  }
  return existingManagementServers;
}
