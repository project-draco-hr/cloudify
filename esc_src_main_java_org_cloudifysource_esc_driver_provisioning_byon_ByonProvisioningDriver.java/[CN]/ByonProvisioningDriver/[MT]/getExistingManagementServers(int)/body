{
  final Set<CustomNode> existingManagementServers=new HashSet<CustomNode>();
  final Set<CustomNode> allNodes=deployer.getAllNodesByTemplateName(cloudTemplateName);
  String managementIP=null;
  for (  final CustomNode server : allNodes) {
    try {
      IPUtils.validateConnection(server.getPrivateIP(),this.restPort);
      managementIP=server.getPrivateIP();
      break;
    }
 catch (    final Exception ex) {
    }
  }
  if (StringUtils.isNotBlank(managementIP)) {
    final Integer discoveryPort=getLusPort();
    final Admin admin=Utils.getAdminObject(managementIP,expectedGsmCount,discoveryPort);
    try {
      final GridServiceManagers gsms=admin.getGridServiceManagers();
      gsms.waitForAtLeastOne(MANAGEMENT_LOCATION_TIMEOUT,TimeUnit.SECONDS);
      for (      final GridServiceManager gsm : gsms) {
        final CustomNode managementServer=deployer.getServerByIP(cloudTemplateName,gsm.getMachine().getHostAddress());
        if (managementServer != null) {
          existingManagementServers.add(managementServer);
        }
      }
    }
  finally {
      admin.close();
    }
  }
  return existingManagementServers;
}
