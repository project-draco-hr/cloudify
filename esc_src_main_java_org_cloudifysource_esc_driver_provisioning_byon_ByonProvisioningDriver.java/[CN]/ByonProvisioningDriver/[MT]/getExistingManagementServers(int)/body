{
  final Set<CustomNode> existingManagementServers=new HashSet<CustomNode>();
  final Set<CustomNode> allNodes=getDeployer().getAllNodesByTemplateName(cloudTemplateName);
  String managementIP=null;
  for (  final CustomNode server : allNodes) {
    try {
      IPUtils.validateConnection(server.getPrivateIP(),this.restPort);
      managementIP=server.getPrivateIP();
      break;
    }
 catch (    final Exception ex) {
      logger.info("******** getExistingManagementServers failed to connect to byon node: " + server.getPrivateIP() + " on port "+ this.restPort+ ". Reported error: "+ ex.getMessage());
      logger.info("******** This is OK if this is not a management machine, othewise this indicates a " + "communication " + "error");
      ex.printStackTrace();
    }
  }
  if (StringUtils.isNotBlank(managementIP)) {
    logger.info("******** found management machine: " + managementIP);
    final Integer discoveryPort=getLusPort();
    logger.info("******** Attempting to create admin with locator " + IPUtils.getSafeIpAddress(managementIP) + ":"+ discoveryPort);
    final Admin admin=Utils.getAdminObject(managementIP,expectedGsmCount,discoveryPort);
    try {
      logger.info("******** trying to discover GSMs");
      final GridServiceManagers gsms=admin.getGridServiceManagers();
      gsms.waitForAtLeastOne(MANAGEMENT_LOCATION_TIMEOUT,TimeUnit.SECONDS);
      for (      final GridServiceManager gsm : gsms) {
        final CustomNode managementServer=getDeployer().getServerByIP(cloudTemplateName,gsm.getMachine().getHostAddress());
        if (managementServer != null) {
          existingManagementServers.add(managementServer);
        }
      }
    }
 catch (    Exception e) {
      logger.info("******** Exception thrown while trying to discover GSMs, reported error: " + e.getMessage());
    }
 finally {
      admin.close();
    }
  }
  return existingManagementServers;
}
