{
  final long end=System.currentTimeMillis() + unit.toMillis(timeout);
  if (details.getLocator() == null) {
    details.setLocator(details.getPrivateIp());
  }
  logger.fine("Executing agentless installer with the following details:\n" + details.toString());
  final String targetHost=details.isConnectedToPrivateIp() ? details.getPrivateIp() : details.getPublicIp();
  final int port=details.getFileTransferMode().getDefaultPort();
  publishEvent("attempting_to_access_vm",targetHost);
  checkConnection(targetHost,port,CalcUtils.millisUntil(end),TimeUnit.MILLISECONDS);
  File environmentFile=null;
  try {
    environmentFile=createEnvironmentFile(details);
    publishEvent("uploading_files_to_node",targetHost);
    uploadFilesToServer(details,environmentFile,end,targetHost);
  }
 catch (  final IOException e) {
    throw new InstallerException("Failed to create environment file",e);
  }
 finally {
    if (environmentFile != null) {
      FileUtils.deleteQuietly(environmentFile.getParentFile());
    }
  }
  publishEvent("launching_agent_on_node",targetHost);
  remoteExecuteAgentOnServer(details,end,targetHost);
  publishEvent("install_completed_on_node",targetHost);
}
