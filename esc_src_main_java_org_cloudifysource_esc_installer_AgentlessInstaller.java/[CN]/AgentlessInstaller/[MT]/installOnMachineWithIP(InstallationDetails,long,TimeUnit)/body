{
  final long end=System.currentTimeMillis() + unit.toMillis(timeout);
  if (details.getLocator() == null) {
    details.setLocator(details.getPrivateIp());
  }
  logger.fine("Executing agentless installer with the following details:\n" + details.toString());
  final String targetHost=details.isConnectedToPrivateIp() ? details.getPrivateIp() : details.getPublicIp();
  publishEvent("attempting_to_access_vm_with_ssh",targetHost);
  int port=0;
switch (details.getFileTransferMode()) {
case CIFS:
    port=CIFS_PORT;
  break;
case SCP:
port=SSH_PORT;
break;
default :
throw new UnsupportedOperationException("File Transfer Mode: " + details.getFileTransferMode() + " not supported");
}
checkConnection(targetHost,port,Utils.millisUntil(end),TimeUnit.MILLISECONDS);
uploadFilesToServer(details,end,targetHost);
remoteExecuteAgentOnServer(details,end,targetHost);
publishEvent("access_vm_with_ssh_success",details.getPublicIp());
}
