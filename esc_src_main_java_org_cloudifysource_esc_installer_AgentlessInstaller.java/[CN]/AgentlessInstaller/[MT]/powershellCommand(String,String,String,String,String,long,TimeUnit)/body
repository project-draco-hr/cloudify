{
  try {
    checkPowershellInstalled();
  }
 catch (  final IOException e) {
    throw new InstallerException("Error while trying to find powershell.exe",e);
  }
  final String formattedCommand=String.format(POWER_SHELL_COMMAND_TEMPLATE,password,username,targetHost,command);
  File tempScriptFile=null;
  try {
    tempScriptFile=createTempScriptFile(formattedCommand);
  }
 catch (  final IOException e) {
    throw new InstallerException("Failed to create script file",e);
  }
  final List<String> fullCommand=new LinkedList<String>();
  fullCommand.addAll(Arrays.asList(POWER_SHELL_PREFIX));
  fullCommand.add(tempScriptFile.getAbsolutePath());
  checkConnection(targetHost,POWERSHELL_PORT,millisUntil,milliseconds);
  final ProcessBuilder pb=new ProcessBuilder(fullCommand);
  pb.redirectErrorStream(true);
  try {
    final Process p=pb.start();
    final String output=readProcessOutput(p);
    final int exitCode=p.waitFor();
    if (exitCode != 0) {
      throw new InstallerException("Remote installation failed with exit code: " + exitCode + ". Execution output: "+ output);
    }
  }
 catch (  final IOException e) {
    throw new InstallerException("Failed to invoke remote installation: " + e.getMessage(),e);
  }
 finally {
    tempScriptFile.delete();
  }
}
